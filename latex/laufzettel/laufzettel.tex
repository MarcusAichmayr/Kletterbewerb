\documentclass[a4paper, 12pt]{article}

\input{../include/libs.tex}

\usepackage[
	top = 9mm,
	bottom = 9mm,
	left = 9mm,
	right = 9mm,
]{geometry}

\setlength\parindent{0pt}
\fontdimen2\font=0pt
\setlength\lineskip{4pt}

\newcolumntype{x}{>{\centering\arraybackslash}p{1.2cm}}

\newcommand{\routen}[1]{
	\begin{tabular}{@{}|p{4.5cm}|x|x|x}
		Route$\setminus$Versuche & 1 & 2 & 3
		\DTLforeach[\equal{\gruppe}{yes}]{routen}
		{
			\inputID=ID,
			\inputfarbe=Farbe,
			\inputanzahl=Anzahl Griffe,
			\gruppe=#1}
		{\\\hline \inputID{} \textbf{\inputfarbe{}} (\inputanzahl) & \vphantom{\rule{0pt}{1cm}} & &}
		\\
	\end{tabular}
}

\pgfmathsetmacro{\width}{19}
\pgfmathsetmacro{\height}{5}
\newcommand{\zettel}[2]
{\begin{tikzpicture}
	\node [draw] {
		\begin{tikzpicture}
			\node (Bewerb) [
				below left,
				align=left,
				inner sep=2pt
			]
			{
				\LARGE Topropeklettern 5. April 2024
				\\
				Gruppe: \itshape\DTLfetch{gruppen}{ID}{#2}{Bezeichnung}
				\\
				Name:
				\\[.2cm]
				\LARGE\bfseries #1
			};
			\node (Routen) [
				right=6pt of Bewerb.north east,
				anchor=north west,
				inner sep=-6pt
			] {\routen{#2}};
			% \node [below=5pt of Bewerb.south west, anchor=north west] {\huge #1};
		\end{tikzpicture}
	};
	% \draw (0, 0) rectangle (\width, \height);
	% \node[above=0pt of Routen.north west, anchor=south west, text depth=0pt] {\huge #1};
	% \node[
	% 	above=0pt of Routen.north east,
	% 	anchor=south east,
	% 	text depth=0pt,
	% 	font=\itshape,
	% ] {\DTLfetch{gruppen}{ID}{#2}{Bezeichnung}};
\end{tikzpicture}
}

\begin{document}

\pagestyle{empty}

% \raggedright
\centering

\Large

\DTLloaddb{routen}{../../data/routen.csv}
\DTLloaddb{teilnehmer}{../../data/teilnehmer.csv}
\DTLloaddb{gruppen}{../../data/gruppen.csv}

\DTLforeach{teilnehmer}
{
	\inputname=Name,
	\inputalter=Alter,
	\inputgruppe=Gruppe}
{\zettel{\inputname}{\inputgruppe}}
% \zettel{Ulrike Gurke}{1}
% \zettel{}{1} % Blanko
% \zettel{}{4} % Blanko

\end{document}
